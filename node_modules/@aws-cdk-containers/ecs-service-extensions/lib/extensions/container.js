"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Container = void 0;
const ecs = require("@aws-cdk/aws-ecs");
const extension_interfaces_1 = require("./extension-interfaces");
/**
 * The main container of a service. This is generally the container
 * which runs your application business logic. Other extensions will attach
 * sidecars alongside this main container.
 */
class Container extends extension_interfaces_1.ServiceExtension {
    constructor(props) {
        super('service-container');
        this.props = props;
        this.trafficPort = props.trafficPort;
    }
    // @ts-ignore - Ignore unused params that are required for abstract class extend
    prehook(service, scope) {
        this.parentService = service;
    }
    // This hook sets the overall task resource requirements to the
    // resource requirements of the application itself.
    modifyTaskDefinitionProps(props) {
        return {
            ...props,
            cpu: this.props.cpu.toString(),
            memoryMiB: this.props.memoryMiB.toString(),
        };
    }
    // This hook adds the application container to the task definition.
    useTaskDefinition(taskDefinition) {
        let containerProps = {
            image: this.props.image,
            cpu: Number(this.props.cpu),
            memoryLimitMiB: Number(this.props.memoryMiB),
            environment: this.props.environment,
        };
        // Let other extensions mutate the container definition. This is
        // used by extensions which want to add environment variables, modify
        // logging parameters, etc.
        this.containerMutatingHooks.forEach((hookProvider) => {
            containerProps = hookProvider.mutateContainerDefinition(containerProps);
        });
        this.container = taskDefinition.addContainer('app', containerProps);
        // Create a port mapping for the container
        this.container.addPortMappings({
            containerPort: this.trafficPort,
        });
        // Raise the ulimits for this main application container
        // so that it can handle more concurrent requests
        this.container.addUlimits({
            softLimit: 1024000,
            hardLimit: 1024000,
            name: ecs.UlimitName.NOFILE,
        });
    }
    resolveContainerDependencies() {
        if (!this.container) {
            throw new Error('The container dependency hook was called before the container was created');
        }
        const firelens = this.parentService.serviceDescription.get('firelens');
        if (firelens && firelens.container) {
            this.container.addContainerDependencies({
                container: firelens.container,
                condition: ecs.ContainerDependencyCondition.START,
            });
        }
        const appmeshextension = this.parentService.serviceDescription.get('appmesh');
        if (appmeshextension && appmeshextension.container) {
            this.container.addContainerDependencies({
                container: appmeshextension.container,
                condition: ecs.ContainerDependencyCondition.HEALTHY,
            });
        }
        const cloudwatchextension = this.parentService.serviceDescription.get('cloudwatchAgent');
        if (cloudwatchextension && cloudwatchextension.container) {
            this.container.addContainerDependencies({
                container: cloudwatchextension.container,
                condition: ecs.ContainerDependencyCondition.START,
            });
        }
        const xrayextension = this.parentService.serviceDescription.get('xray');
        if (xrayextension && xrayextension.container) {
            this.container.addContainerDependencies({
                container: xrayextension.container,
                condition: ecs.ContainerDependencyCondition.HEALTHY,
            });
        }
    }
}
exports.Container = Container;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHdDQUF3QztBQUV4QyxpRUFBMEQ7QUF3QzFEOzs7O0dBSUc7QUFDSCxNQUFhLFNBQVUsU0FBUSx1Q0FBZ0I7SUFXN0MsWUFBWSxLQUE4QjtRQUN4QyxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUM7SUFDdkMsQ0FBQztJQUVELGdGQUFnRjtJQUN6RSxPQUFPLENBQUMsT0FBZ0IsRUFBRSxLQUFnQjtRQUMvQyxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQztJQUMvQixDQUFDO0lBRUQsK0RBQStEO0lBQy9ELG1EQUFtRDtJQUM1Qyx5QkFBeUIsQ0FBQyxLQUE4QjtRQUM3RCxPQUFPO1lBQ0wsR0FBRyxLQUFLO1lBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRTtZQUM5QixTQUFTLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFO1NBQ2hCLENBQUM7SUFDL0IsQ0FBQztJQUVELG1FQUFtRTtJQUM1RCxpQkFBaUIsQ0FBQyxjQUFrQztRQUN6RCxJQUFJLGNBQWMsR0FBRztZQUNuQixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLO1lBQ3ZCLEdBQUcsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7WUFDM0IsY0FBYyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztZQUM1QyxXQUFXLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXO1NBQ0YsQ0FBQztRQUVwQyxnRUFBZ0U7UUFDaEUscUVBQXFFO1FBQ3JFLDJCQUEyQjtRQUMzQixJQUFJLENBQUMsc0JBQXNCLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxFQUFFLEVBQUU7WUFDbkQsY0FBYyxHQUFHLFlBQVksQ0FBQyx5QkFBeUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUMxRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFFcEUsMENBQTBDO1FBQzFDLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDO1lBQzdCLGFBQWEsRUFBRSxJQUFJLENBQUMsV0FBVztTQUNoQyxDQUFDLENBQUM7UUFFSCx3REFBd0Q7UUFDeEQsaURBQWlEO1FBQ2pELElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO1lBQ3hCLFNBQVMsRUFBRSxPQUFPO1lBQ2xCLFNBQVMsRUFBRSxPQUFPO1lBQ2xCLElBQUksRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU07U0FDNUIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLDRCQUE0QjtRQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLDJFQUEyRSxDQUFDLENBQUM7U0FDOUY7UUFFRCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN2RSxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsU0FBUyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxTQUFTLENBQUMsd0JBQXdCLENBQUM7Z0JBQ3RDLFNBQVMsRUFBRSxRQUFRLENBQUMsU0FBUztnQkFDN0IsU0FBUyxFQUFFLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxLQUFLO2FBQ2xELENBQUMsQ0FBQztTQUNKO1FBRUQsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM5RSxJQUFJLGdCQUFnQixJQUFJLGdCQUFnQixDQUFDLFNBQVMsRUFBRTtZQUNsRCxJQUFJLENBQUMsU0FBUyxDQUFDLHdCQUF3QixDQUFDO2dCQUN0QyxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsU0FBUztnQkFDckMsU0FBUyxFQUFFLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPO2FBQ3BELENBQUMsQ0FBQztTQUNKO1FBRUQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3pGLElBQUksbUJBQW1CLElBQUksbUJBQW1CLENBQUMsU0FBUyxFQUFFO1lBQ3hELElBQUksQ0FBQyxTQUFTLENBQUMsd0JBQXdCLENBQUM7Z0JBQ3RDLFNBQVMsRUFBRSxtQkFBbUIsQ0FBQyxTQUFTO2dCQUN4QyxTQUFTLEVBQUUsR0FBRyxDQUFDLDRCQUE0QixDQUFDLEtBQUs7YUFDbEQsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4RSxJQUFJLGFBQWEsSUFBSSxhQUFhLENBQUMsU0FBUyxFQUFFO1lBQzVDLElBQUksQ0FBQyxTQUFTLENBQUMsd0JBQXdCLENBQUM7Z0JBQ3RDLFNBQVMsRUFBRSxhQUFhLENBQUMsU0FBUztnQkFDbEMsU0FBUyxFQUFFLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPO2FBQ3BELENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztDQUNGO0FBckdELDhCQXFHQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGVjcyBmcm9tICdAYXdzLWNkay9hd3MtZWNzJztcbmltcG9ydCB7IFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlJztcbmltcG9ydCB7IFNlcnZpY2VFeHRlbnNpb24gfSBmcm9tICcuL2V4dGVuc2lvbi1pbnRlcmZhY2VzJztcblxuLy8ga2VlcCB0aGlzIGltcG9ydCBzZXBhcmF0ZSBmcm9tIG90aGVyIGltcG9ydHMgdG8gcmVkdWNlIGNoYW5jZSBmb3IgbWVyZ2UgY29uZmxpY3RzIHdpdGggdjItbWFpblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWR1cGxpY2F0ZS1pbXBvcnRzLCBpbXBvcnQvb3JkZXJcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuXG4vKipcbiAqIFNldHRpbmcgZm9yIHRoZSBtYWluIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBvZiBhIHNlcnZpY2UuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29udGFpbmVyRXh0ZW5zaW9uUHJvcHMge1xuICAvKipcbiAgICogSG93IG11Y2ggQ1BVIHRoZSBjb250YWluZXIgcmVxdWlyZXMuXG4gICAqL1xuICByZWFkb25seSBjcHU6IG51bWJlcixcblxuICAvKipcbiAgICogSG93IG11Y2ggbWVtb3J5IGluIG1lZ2FieXRlcyB0aGUgY29udGFpbmVyIHJlcXVpcmVzLlxuICAgKi9cbiAgcmVhZG9ubHkgbWVtb3J5TWlCOiBudW1iZXIsXG5cbiAgLyoqXG4gICAqIFRoZSBpbWFnZSB0byBydW4uXG4gICAqL1xuICByZWFkb25seSBpbWFnZTogZWNzLkNvbnRhaW5lckltYWdlLFxuXG4gIC8qKlxuICAgKiBXaGF0IHBvcnQgdGhlIGltYWdlIGxpc3RlbiBmb3IgdHJhZmZpYyBvbi5cbiAgICovXG4gIHJlYWRvbmx5IHRyYWZmaWNQb3J0OiBudW1iZXIsXG5cbiAgLyoqXG4gICAqIEVudmlyb25tZW50IHZhcmlhYmxlcyB0byBwYXNzIGludG8gdGhlIGNvbnRhaW5lci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBlbnZpcm9ubWVudCB2YXJpYWJsZXMuXG4gICAqL1xuICByZWFkb25seSBlbnZpcm9ubWVudD86IHtcbiAgICBba2V5OiBzdHJpbmddOiBzdHJpbmcsXG4gIH1cbn1cblxuLyoqXG4gKiBUaGUgbWFpbiBjb250YWluZXIgb2YgYSBzZXJ2aWNlLiBUaGlzIGlzIGdlbmVyYWxseSB0aGUgY29udGFpbmVyXG4gKiB3aGljaCBydW5zIHlvdXIgYXBwbGljYXRpb24gYnVzaW5lc3MgbG9naWMuIE90aGVyIGV4dGVuc2lvbnMgd2lsbCBhdHRhY2hcbiAqIHNpZGVjYXJzIGFsb25nc2lkZSB0aGlzIG1haW4gY29udGFpbmVyLlxuICovXG5leHBvcnQgY2xhc3MgQ29udGFpbmVyIGV4dGVuZHMgU2VydmljZUV4dGVuc2lvbiB7XG4gIC8qKlxuICAgKiBUaGUgcG9ydCBvbiB3aGljaCB0aGUgY29udGFpbmVyIGV4cGVjdHMgdG8gcmVjZWl2ZSBuZXR3b3JrIHRyYWZmaWNcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB0cmFmZmljUG9ydDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgc2V0dGluZ3MgZm9yIHRoZSBjb250YWluZXIuXG4gICAqL1xuICBwcml2YXRlIHByb3BzOiBDb250YWluZXJFeHRlbnNpb25Qcm9wcztcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogQ29udGFpbmVyRXh0ZW5zaW9uUHJvcHMpIHtcbiAgICBzdXBlcignc2VydmljZS1jb250YWluZXInKTtcbiAgICB0aGlzLnByb3BzID0gcHJvcHM7XG4gICAgdGhpcy50cmFmZmljUG9ydCA9IHByb3BzLnRyYWZmaWNQb3J0O1xuICB9XG5cbiAgLy8gQHRzLWlnbm9yZSAtIElnbm9yZSB1bnVzZWQgcGFyYW1zIHRoYXQgYXJlIHJlcXVpcmVkIGZvciBhYnN0cmFjdCBjbGFzcyBleHRlbmRcbiAgcHVibGljIHByZWhvb2soc2VydmljZTogU2VydmljZSwgc2NvcGU6IENvbnN0cnVjdCkge1xuICAgIHRoaXMucGFyZW50U2VydmljZSA9IHNlcnZpY2U7XG4gIH1cblxuICAvLyBUaGlzIGhvb2sgc2V0cyB0aGUgb3ZlcmFsbCB0YXNrIHJlc291cmNlIHJlcXVpcmVtZW50cyB0byB0aGVcbiAgLy8gcmVzb3VyY2UgcmVxdWlyZW1lbnRzIG9mIHRoZSBhcHBsaWNhdGlvbiBpdHNlbGYuXG4gIHB1YmxpYyBtb2RpZnlUYXNrRGVmaW5pdGlvblByb3BzKHByb3BzOiBlY3MuVGFza0RlZmluaXRpb25Qcm9wcyk6IGVjcy5UYXNrRGVmaW5pdGlvblByb3BzIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4ucHJvcHMsXG4gICAgICBjcHU6IHRoaXMucHJvcHMuY3B1LnRvU3RyaW5nKCksXG4gICAgICBtZW1vcnlNaUI6IHRoaXMucHJvcHMubWVtb3J5TWlCLnRvU3RyaW5nKCksXG4gICAgfSBhcyBlY3MuVGFza0RlZmluaXRpb25Qcm9wcztcbiAgfVxuXG4gIC8vIFRoaXMgaG9vayBhZGRzIHRoZSBhcHBsaWNhdGlvbiBjb250YWluZXIgdG8gdGhlIHRhc2sgZGVmaW5pdGlvbi5cbiAgcHVibGljIHVzZVRhc2tEZWZpbml0aW9uKHRhc2tEZWZpbml0aW9uOiBlY3MuVGFza0RlZmluaXRpb24pIHtcbiAgICBsZXQgY29udGFpbmVyUHJvcHMgPSB7XG4gICAgICBpbWFnZTogdGhpcy5wcm9wcy5pbWFnZSxcbiAgICAgIGNwdTogTnVtYmVyKHRoaXMucHJvcHMuY3B1KSxcbiAgICAgIG1lbW9yeUxpbWl0TWlCOiBOdW1iZXIodGhpcy5wcm9wcy5tZW1vcnlNaUIpLFxuICAgICAgZW52aXJvbm1lbnQ6IHRoaXMucHJvcHMuZW52aXJvbm1lbnQsXG4gICAgfSBhcyBlY3MuQ29udGFpbmVyRGVmaW5pdGlvbk9wdGlvbnM7XG5cbiAgICAvLyBMZXQgb3RoZXIgZXh0ZW5zaW9ucyBtdXRhdGUgdGhlIGNvbnRhaW5lciBkZWZpbml0aW9uLiBUaGlzIGlzXG4gICAgLy8gdXNlZCBieSBleHRlbnNpb25zIHdoaWNoIHdhbnQgdG8gYWRkIGVudmlyb25tZW50IHZhcmlhYmxlcywgbW9kaWZ5XG4gICAgLy8gbG9nZ2luZyBwYXJhbWV0ZXJzLCBldGMuXG4gICAgdGhpcy5jb250YWluZXJNdXRhdGluZ0hvb2tzLmZvckVhY2goKGhvb2tQcm92aWRlcikgPT4ge1xuICAgICAgY29udGFpbmVyUHJvcHMgPSBob29rUHJvdmlkZXIubXV0YXRlQ29udGFpbmVyRGVmaW5pdGlvbihjb250YWluZXJQcm9wcyk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IHRhc2tEZWZpbml0aW9uLmFkZENvbnRhaW5lcignYXBwJywgY29udGFpbmVyUHJvcHMpO1xuXG4gICAgLy8gQ3JlYXRlIGEgcG9ydCBtYXBwaW5nIGZvciB0aGUgY29udGFpbmVyXG4gICAgdGhpcy5jb250YWluZXIuYWRkUG9ydE1hcHBpbmdzKHtcbiAgICAgIGNvbnRhaW5lclBvcnQ6IHRoaXMudHJhZmZpY1BvcnQsXG4gICAgfSk7XG5cbiAgICAvLyBSYWlzZSB0aGUgdWxpbWl0cyBmb3IgdGhpcyBtYWluIGFwcGxpY2F0aW9uIGNvbnRhaW5lclxuICAgIC8vIHNvIHRoYXQgaXQgY2FuIGhhbmRsZSBtb3JlIGNvbmN1cnJlbnQgcmVxdWVzdHNcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRVbGltaXRzKHtcbiAgICAgIHNvZnRMaW1pdDogMTAyNDAwMCxcbiAgICAgIGhhcmRMaW1pdDogMTAyNDAwMCxcbiAgICAgIG5hbWU6IGVjcy5VbGltaXROYW1lLk5PRklMRSxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyByZXNvbHZlQ29udGFpbmVyRGVwZW5kZW5jaWVzKCkge1xuICAgIGlmICghdGhpcy5jb250YWluZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGNvbnRhaW5lciBkZXBlbmRlbmN5IGhvb2sgd2FzIGNhbGxlZCBiZWZvcmUgdGhlIGNvbnRhaW5lciB3YXMgY3JlYXRlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGZpcmVsZW5zID0gdGhpcy5wYXJlbnRTZXJ2aWNlLnNlcnZpY2VEZXNjcmlwdGlvbi5nZXQoJ2ZpcmVsZW5zJyk7XG4gICAgaWYgKGZpcmVsZW5zICYmIGZpcmVsZW5zLmNvbnRhaW5lcikge1xuICAgICAgdGhpcy5jb250YWluZXIuYWRkQ29udGFpbmVyRGVwZW5kZW5jaWVzKHtcbiAgICAgICAgY29udGFpbmVyOiBmaXJlbGVucy5jb250YWluZXIsXG4gICAgICAgIGNvbmRpdGlvbjogZWNzLkNvbnRhaW5lckRlcGVuZGVuY3lDb25kaXRpb24uU1RBUlQsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBhcHBtZXNoZXh0ZW5zaW9uID0gdGhpcy5wYXJlbnRTZXJ2aWNlLnNlcnZpY2VEZXNjcmlwdGlvbi5nZXQoJ2FwcG1lc2gnKTtcbiAgICBpZiAoYXBwbWVzaGV4dGVuc2lvbiAmJiBhcHBtZXNoZXh0ZW5zaW9uLmNvbnRhaW5lcikge1xuICAgICAgdGhpcy5jb250YWluZXIuYWRkQ29udGFpbmVyRGVwZW5kZW5jaWVzKHtcbiAgICAgICAgY29udGFpbmVyOiBhcHBtZXNoZXh0ZW5zaW9uLmNvbnRhaW5lcixcbiAgICAgICAgY29uZGl0aW9uOiBlY3MuQ29udGFpbmVyRGVwZW5kZW5jeUNvbmRpdGlvbi5IRUFMVEhZLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgY2xvdWR3YXRjaGV4dGVuc2lvbiA9IHRoaXMucGFyZW50U2VydmljZS5zZXJ2aWNlRGVzY3JpcHRpb24uZ2V0KCdjbG91ZHdhdGNoQWdlbnQnKTtcbiAgICBpZiAoY2xvdWR3YXRjaGV4dGVuc2lvbiAmJiBjbG91ZHdhdGNoZXh0ZW5zaW9uLmNvbnRhaW5lcikge1xuICAgICAgdGhpcy5jb250YWluZXIuYWRkQ29udGFpbmVyRGVwZW5kZW5jaWVzKHtcbiAgICAgICAgY29udGFpbmVyOiBjbG91ZHdhdGNoZXh0ZW5zaW9uLmNvbnRhaW5lcixcbiAgICAgICAgY29uZGl0aW9uOiBlY3MuQ29udGFpbmVyRGVwZW5kZW5jeUNvbmRpdGlvbi5TVEFSVCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHhyYXlleHRlbnNpb24gPSB0aGlzLnBhcmVudFNlcnZpY2Uuc2VydmljZURlc2NyaXB0aW9uLmdldCgneHJheScpO1xuICAgIGlmICh4cmF5ZXh0ZW5zaW9uICYmIHhyYXlleHRlbnNpb24uY29udGFpbmVyKSB7XG4gICAgICB0aGlzLmNvbnRhaW5lci5hZGRDb250YWluZXJEZXBlbmRlbmNpZXMoe1xuICAgICAgICBjb250YWluZXI6IHhyYXlleHRlbnNpb24uY29udGFpbmVyLFxuICAgICAgICBjb25kaXRpb246IGVjcy5Db250YWluZXJEZXBlbmRlbmN5Q29uZGl0aW9uLkhFQUxUSFksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==